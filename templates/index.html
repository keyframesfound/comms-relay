<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Raspberry Pi Video & Stats</title>
    <style>
        /* Basic styling */
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        .navbar { overflow: hidden; background-color: #333; }
        .navbar a { float: left; display: block; color: #f2f2f2; 
                    text-align: center; padding: 14px 16px; text-decoration: none; }
        .navbar a:hover { background-color: #ddd; color: black; }
        .container { padding: 20px; }
        .video { width: 45%; margin: 2.5%; }
    </style>
    <!-- Added A-Frame library -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <div class="navbar">
        <a href="/?tab=cameras">Cameras</a>
        <a href="/?tab=empty">Empty</a>
        <a href="/?tab=stats">Raspberry Pi Stats</a>
    </div>
    <div class="container">
        {% if tab == 'cameras' %}
            <!-- Cameras tab changed: rendering a live 360 videosphere -->
            <h2>360 Videosphere</h2>
            <a-scene embedded>
                <a-assets>
                    <canvas id="videoCanvas"></canvas>
                </a-assets>
                <a-sky id="videoSphere" src="#videoCanvas" rotation="0 -90 0"></a-sky>
                <a-camera></a-camera>
            </a-scene>
            <!-- Hidden video elements for the two feeds -->
            <video id="video0" src="{{ url_for('video_feed', cam_id=0) }}" autoplay muted loop playsinline style="display:none"></video>
            <video id="video1" src="{{ url_for('video_feed', cam_id=1) }}" autoplay muted loop playsinline style="display:none"></video>
            <script>
                // Stitching the two video feeds into one canvas
                const v0 = document.getElementById("video0");
                const v1 = document.getElementById("video1");
                const canvas = document.getElementById("videoCanvas");
                const ctx = canvas.getContext("2d");
                // Assuming each video is 640x480; canvas is 1280x480
                canvas.width = 1280;
                canvas.height = 480;
                function draw() {
                    if(v0.readyState >= 2 && v1.readyState >= 2) {
                        // Draw left half from v0 and right half from v1.
                        ctx.drawImage(v0, 0, 0, 640, 480);
                        ctx.drawImage(v1, 640, 0, 640, 480);
                    }
                    requestAnimationFrame(draw);
                }
                draw();
            </script>
        {% elif tab == 'stats' %}
            <!-- Raspberry Pi stats tab: display CPU, memory, and temperature -->
            <h2>Raspberry Pi Stats</h2>
            <p>CPU Usage: {{ stats.cpu_percent }}%</p>
            <p>Temperature: {{ stats.temperature }}Â°C</p>
            <p>Memory Stats:</p>
            <ul>
                <li>Total: {{ stats.memory.total // (1024*1024) }} MB</li>
                <li>Available: {{ stats.memory.available // (1024*1024) }} MB</li>
                <li>Used: {{ stats.memory.used // (1024*1024) }} MB</li>
                <li>Percent Used: {{ stats.memory.percent }}%</li>
            </ul>
            <p id="countdown">Next update in: 3.0 seconds</p>
            <script>
                // Countdown refresh script
                let countdownElement = document.getElementById("countdown");
                let countdown = 3.0;
                let interval = setInterval(function(){
                    countdown -= 0.1;
                    if (countdown <= 0) {
                        clearInterval(interval);
                        window.location.reload();
                    } else {
                        countdownElement.textContent = "Next update in: " + countdown.toFixed(1) + " seconds";
                    }
                }, 100);
            </script>
        {% else %}
            <!-- Placeholder for empty tab -->
            <h2>Empty Tab</h2>
            <p>Content coming soon!</p>
        {% endif %}
    </div>
</body>
</html>
